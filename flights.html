<head>
		<title>SHelper</title>
		<meta name="viewport" content="user-scalable=no, width=device-width">
		<meta charset="UTF-8">

		<link href="css/bootstrap.min.css" rel="stylesheet" >
		<link href="css/style.css" rel="stylesheet" type="text/css">

		<script src="js/jquery.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
</head>

<body>
	Outbound List: <textarea id="outbound" rows="5"></textarea>
	<button onclick="compute(0)">Go</button><br/>
	Inbound List: <textarea id="inbound" rows="5"></textarea>
	<button onclick="compute(1)">Go</button><br/>
	Ans: <textarea id="ans_txt" rows="5" style="width:300px"></textarea><div id="total"></div>
</body>

<script>
var gates = {};
var gate_changes = {};

  Array.prototype.unique = function() {
    return this.filter(function (value, index, self) { 
      return self.indexOf(value) === index;
    });
  }

  function compute(type = -1) {
    var result = "";
    var reg;

    $("#total").html("");
    if (type != -1) {
	var list_ans = [];
	ans = ((type == 0) ? ($("#outbound").val()) : ($("#inbound").val()));
	if (type == 1) {
		reg = /\n[A-Z]{3}([A-Z]{3})\n/g;
	} else {
		reg = /AA(\d+)\n[^\n]+\nDFW([A-Z]{3})[^\:]+\:\s(\d+)\:(\d+)\:[^\n]+\n[^\:]+\:\s([^\n]+)\nDFW\n\d/g;
	}

	var net = 0;
	var result2;
	var list_ans = {};
	while((result2 = reg.exec(ans)) !== null && net < 1000) {
		if (type == 1) {
    			if (!(result2[1] in list_ans)) {
				list_ans[result2[1]] = 0;
			}
			list_ans[result2[1]]++;
		} else {
			if (!(result2[1] in gates)) {
				gates[result2[1]] = result2[5];
			}
			if (gates[result2[1]] != result2[5]) {
				$("#total").html($("#total").html() + result2[1] + ": " + gates[result2[1]] + " -> " + result2[5] + "\n");
				if (!(result2[1] in gate_changes)) {
					gate_changes[result2[1]] = [];
					gate_changes[result2[1]].push(gates[result2[1]]);
				}
				gate_changes[result2[1]].push(result2[5]);
				gates[result2[1]] = result2[5];
			}
			result += result2[1] + "\t" + result2[5] + "\t" + result2[3] + result2[4] + "\n";
		}
		net++;
	}
	if (type == 1) {
		var total = 0;
		var sortable = [];
		for (var dest in list_ans) {
			total += list_ans[dest];
			sortable.push([dest, list_ans[dest]]);
		}
		sortable.sort(function(a, b) { return b[1] - a[1]; } );
		result += "BULK\t";
		if (sortable.length < 3) {
			sortable.forEach(function(item, index) {
				result += item[0] + "\t" + item[1] + "\n \t";
			});
		} else {
			for (var i = 0; i < Math.floor(sortable.length / 2); i++) {
				result += sortable[i][0] + "\t" + sortable[i][1] + "\t" +
				sortable[i + Math.ceil(sortable.length / 2)][0] + "\t" + sortable[i + Math.ceil(sortable.length / 2)][1] + "\n \t";
            		}
			if (sortable.length % 2 == 1) {
				result += sortable[Math.floor(sortable.length / 2)][0] + "\t" + sortable[Math.floor(sortable.length / 2)][1];
			}
		}
		$("#total").html("TOTAL: " + total);
    	}
    	$('#ans_txt').val(result.trim());
    }
}
</script>
