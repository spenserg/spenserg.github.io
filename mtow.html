<head>
	<title>FKeys Helper</title>
	<meta name="viewport" content="user-scalable=no, width=device-width">
	<meta charset="UTF-8">

	<link href="css/bootstrap.min.css" rel="stylesheet" >
	<link href="css/style.css" rel="stylesheet" type="text/css">

	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>

	<script src="js/aviation/get_routes.js" type="text/javascript"></script>
	<script src="js/aviation/airports.js" type="text/javascript"></script>
	<script src="js/aviation/fkeys.js" type="text/javascript"></script>

	<script src="js/aviation/clt_departures.js" type="text/javascript"></script>
	<script src="js/aviation/dfw_departures.js" type="text/javascript"></script>
	<script src="js/aviation/lax_departures.js" type="text/javascript"></script>
	<script src="js/aviation/mia_departures.js" type="text/javascript"></script>
	<script src="js/aviation/ord_departures.js" type="text/javascript"></script>
	<script src="js/aviation/phx_departures.js" type="text/javascript"></script>

	<style>
		.selected {font-weight:bold;color:black;font-size:20;border:4px solid black}
	</style>
</head>

<body>
	FKeys Page: <textarea id="outbound" rows="5">https://prod-1-public.fk.aa.com</textarea>&nbsp;
	<textarea id="ob_copy" rows="5" hidden></textarea>&nbsp;&nbsp
	<button id="go_button" onclick="compute()">Go</button>&nbsp;&nbsp;<button onclick="clear_input(0)">Clear</button>&nbsp;&nbsp;<button onclick="restore_last()">Refresh/Run Previous</button><br/>
	<div id="total"></div>
</body>

<script>
const M738 = ["3RA", "3RB", "3RC", "3RD", "3RE", "3RF", "3RG", "3RH", "3RJ", "3RK", "3RL", "3RM", "3RN", "3RP", "3RR", "3RS", "3RT", "3RU", "3RV", "3RW", "3RX", "3RY", "3SA", "3SB", "3SC", "3SD", "3SE", "3SF", "3SG", "3SH", "3SJ", "3SK", "3SL", "3SM", "3SN", "3SP", "3SR", "3SS", "3ST", "3SU", "3SV", "3SW", "3SX", "3SY", "3TA", "3TB", "3TC", "3TD", "3TE", "3TF", "3TG", "3TH", "3TJ", "3TK", "3TL", "3TM", "3TN", "3TP", "3TR", "3TS", "3TT", "3TU", "3TV", "3TW", "3TX", "3TY", "3UA", "3UB", "3UC", "3UD", "3UE", "3UF", "3UG", "3UH", "3UJ", "3UK", "3UL", "3UM", "3UN", "3UP", "3UR", "3US", "3UT", "3UU", "3UV", "3UW", "3UX", "3UY", "3VA", "3VB", "3VC", "3VD", "3VE", "3VF", "3VG", "3VH", "3VJ", "3VK", "3VL", "3VM"];
const K738 = ["3AA", "3AB", "3AC", "3AD", "3AE", "3AF", "3AG", "3AH", "3AJ", "3AK", "3AL", "3AM", "3AN", "3AP", "3AR", "3AS", "3AT", "3AU", "3AV", "3AW", "3AX", "3AY", "3BA", "3BB", "3BC", "3BD", "3BE", "3BF", "3BG", "3BH", "3BJ", "3BK", "3BL", "3BM", "3BN", "3BP", "3BR", "3BS", "3BT", "3BU", "3BV", "3BW", "3BX", "3BY", "3CA", "3CB", "3CC", "3CD", "3CE", "3CF", "3CG", "3CH", "3CJ", "3CK", "3CL", "3CM", "3CN", "3CP", "3CR", "3CS", "3CT", "3CU", "3CV", "3CW", "3CX", "3CY", "3DA", "3DB", "3DC", "3DD", "3DE", "3DF", "3DG", "3DH", "3DJ", "3DM", "3DN", "3DP", "3DR", "3DS", "3DT", "3DU", "3DV", "3DW", "3DX", "3DY", "3EA", "3EB", "3EC", "3ED", "3EE", "3EF", "3EG", "3EH", "3EJ", "3EK", "3EL", "3EM", "3EN", "3EP", "3ER", "3ES", "3ET", "3EU", "3EV", "3EW", "3EX", "3EY", "3FA", "3FB", "3FC", "3FD", "3FE", "3FF", "3FG", "3FH", "3FJ", "3FK", "3FL", "3FM", "3FN", "3FP", "3FR", "3FS", "3FT", "3FU", "3FV", "3FW", "3FX", "3FY", "3GA", "3GB", "3GC", "3GD", "3GE", "3GF", "3GG", "3GH", "3GJ", "3GK", "3GL", "3GM", "3GN", "3GP", "3GR", "3GS", "3GT", "3GU", "3GV", "3GW", "3GX", "3GY", "3HA", "3HB", "3HC", "3HD", "3HE", "3HF", "3HG", "3HH", "3HJ", "3HK", "3HL", "3HM", "3HN", "3HP", "3HR", "3HS", "3HT", "3HU", "3HV", "3HW", "3HX", "3HY", "3JA", "3JB", "3JC", "3JD", "3JE", "3JF", "3JG", "3JH", "3JJ", "3JK", "3JL", "3JM", "3JN", "3JP", "3JR", "3JS", "3JT", "3JU", "3JV", "3JW", "3JX", "3JY", "3KA", "3KB", "3KC", "3KD", "3KE", "3KF", "3KG", "3KH", "3KJ", "3KK", "3KL", "3KM", "3KN", "3KP", "3KR", "3KS", "3KT", "3KU", "3KV", "3KW", "3KX", "3KY", "3LA", "3LB"];
const R738 = ["3LC", "3LD", "3LE", "3LF", "3LG", "3LH", "3LJ", "3LK", "3LL", "3LM", "3LN", "3LP", "3LR", "3LS", "3LT", "3LU", "3LV", "3LW", "3LX", "3LY", "3MA", "3MB", "3MC", "3MD", "3ME", "3MF", "3MG", "3MH", "3MJ", "3MK", "3ML", "3MM", "3MN", "3MP", "3MR", "3MU", "3MV", "3MW", "3MX", "3MY", "3NA", "3NB", "3NC", "3ND", "3NE", "3NF", "3NG", "3NH", "3NJ", "3NK", "3NL", "3NM", "3NN", "3NP", "3NR", "3NS", "3NT", "3NU", "3NV", "3NW", "3NX", "3NY", "3PA", "3PB", "3PC", "3PD", "3PE", "3PF", "3PG", "3PH", "3PJ", "3PK", "3PL", "3PM", "3PN", "3PP", "3PR", "3PS", "3PT", "3PU", "3PV", "3PW", "3PX"];
const T321 = ["783", "784", "785", "786", "787", "788", "789", "790", "791", "792", "793", "794", "795", "798", "799"];
const S319 = ["001", "002", "003", "004", "005", "006", "007", "008", "009", "010", "011", "012", "013", "014", "015", "016", "017", "018", "019", "020", "021", "022", "023", "024", "025", "026", "027", "028", "029", "030", "031", "032"];
const H319 = ["742", "744", "745", "746", "747", "748", "749", "750", "751", "752", "753", "754", "755", "756", "757", "758", "760", "762", "763", "764", "765", "766", "767", "768", "769", "770", "771", "772", "773", "774", "775", "776", "777", "778", "801", "802", "803", "804", "805", "806", "807", "808", "809", "810", "812", "813", "814", "815", "816", "817", "818", "819", "820", "821", "822", "823", "824", "825", "826", "827", "828", "829", "830", "831", "832", "833", "834", "835", "836", "837", "838", "839", "840"];
const W319 = ["700", "701", "702", "703", "704", "705", "708", "709", "710", "711", "712", "713", "714", "715", "716", "717", "721", "722", "723", "724", "725", "730", "732", "733", "737", "738", "740", "741"];
const A320 = ["102", "103", "104", "105", "107", "108", "109", "110", "111", "112", "114", "117", "118", "119", "121", "122", "123", "124", "125", "126", "127", "128"];
const H205 = ["601", "604", "647", "649", "650", "651", "652", "653", "654", "655", "656", "657", "658", "659", "660", "661", "662", "663", "664", "665", "667", "668", "669", "673", "679", "680"];
const A321 = ["191", "540", "544", "549", "559"];
const E321 = ["400", "401", "402", "403", "404", "405", "406", "407", "408", "409", "410", "411", "412", "413", "414", "415", "416", "417", "418", "419", "420", "421", "422", "423", "424", "425", "426", "427", "428", "429", "430", "431", "432", "433", "434", "435", "436", "437", "438", "439", "440", "441", "442", "443", "444", "445", "446", "447", "448", "449", "450", "451", "452", "453", "454", "455", "456", "457", "458", "459", "460", "461", "462", "463", "464", "465", "466", "467", "468", "469", "470", "471", "472", "473"];
const K321 = ["150", "151", "152", "153", "154", "155", "156", "157", "161", "162", "163", "165", "167", "169", "170", "171", "172", "173", "174", "176", "177", "178", "179", "180", "181", "182", "183", "184", "185", "186", "187", "188", "189", "190", "192", "193", "194", "195", "196", "197", "198", "199", "507", "508", "509", "510", "519", "521", "523", "524", "534", "535", "536", "537", "538", "539", "542", "543", "545", "546", "551", "552", "553", "554", "556", "557", "558", "560", "561", "562", "563", "567", "568", "572", "573", "575", "576", "578", "579", "580", "581", "582", "583", "584", "585", "586", "587", "912", "913", "914", "915", "916", "917", "918", "919", "920", "921", "922", "923", "924", "925", "926", "927", "970", "971", "972", "973", "974", "975", "976", "977", "978", "979", "980", "981", "982"];
const R321 = ["797", "850", "851", "852", "853", "854", "855", "856", "857", "858", "859", "860", "861", "862", "863", "864", "865", "866", "867", "868", "869", "870", "871", "872", "873", "874", "875", "876", "877", "878", "879", "880", "881", "882", "883", "884", "885", "886", "887", "888", "889", "890", "891", "892", "893", "894", "895", "896", "897", "898", "899", "900", "901", "902", "903", "904", "905", "906", "907", "908", "909", "910", "928", "929", "930", "931", "932", "933", "934", "986", "987", "988", "989", "990", "991", "992", "993", "994", "995", "996", "997", "998"];
const N321 = ["950", "951", "952", "953", "954", "955", "956", "957", "958", "959"];
const W773 = ["7LA", "7LB", "7LC", "7LD", "7LE", "7LF", "7LG", "7LH", "7LJ", "7LK", "7LL", "7LM", "7LN", "7LP", "7LR", "7LS", "7LT", "7LU", "7LV", "7LW"];
const B772 = ["7AA", "7AB", "7AC", "7AD", "7AE", "7AF", "7AG", "7AH", "7AJ", "7AK", "7AL", "7AM", "7AN", "7AP", "7AR", "7AS", "7AT", "7AU", "7AV", "7AW", "7AX", "7AY", "7BA", "7BB", "7BC", "7BD", "7BE", "7BF", "7BG", "7BH", "7BJ", "7BK", "7BL", "7BM", "7BN", "7BP", "7BR", "7BS", "7BT", "7BU", "7BV", "7BW", "7BX", "7BY", "7CA", "7CB", "7CC"];
const A332 = ["279", "280", "281", "282", "283", "284", "285", "286", "287", "288", "289", "290", "291", "292", "293"];
const E787 = ["8AA", "8AB", "8AC", "8AD", "8AE", "8AF", "8AG", "8AH", "8AJ", "8AK", "8AL", "8AM", "8AN", "8AP", "8AR", "8AS", "8AT", "8AU", "8AV", "8AW", "8AX", "8AY", "8BA", "8BB", "8BC", "8BD", "8BE", "8BF", "8BG", "8BH", "8BJ", "8BK", "8BL", "8BM", "8BN", "8BP", "8BR"];
const N787 = ["8LA", "8LB", "8LC", "8LD", "8LE", "8LF", "8LG", "8LH", "8LJ", "8LK", "8LL", "8LM", "8LN", "8LP", "8LR", "8LS", "8LT", "8LU", "8LV", "8LW", "8LX", "8LY"];
const P789 = ["8MA", "8MB", "8MC", "8MD"];

const partTimeControlTowers = ["BFL", "BTV", "CHS", "EYW", "GRR", "MAF", "MSO", "MYR", "PSP", "RAP", "RDM", "SJC"];

var flows = {"ABQ":0,"ATL":0,"BZN":0,"DFW":0,"DTW":0,"IAH":0,"JAC":0,"MCO":0,"MIA":0,"MSO":0,"RNO":0,"SAN":0,"SFO":0,"SJC":0,"SLC":0,"SMF":0,"SNA":0, "TUS":0};

document.getElementById("outbound").addEventListener("keypress", function(event) {
	if (event.key === "Enter") {
		event.preventDefault();
		document.getElementById("go_button").click();
	}
});

function restore_last() {
	$("#outbound").val($("#ob_copy").val());
	compute();
}

function change_flow(airport = null, new_config = null, override_duplicated = false) {
	airport = ((airport == null) ? null : airport.toUpperCase(0));
	if ((override_duplicated && airport != null) || ([0,1,2].includes(new_config) && flows[airport] !== undefined)) {
		flows[airport] = new_config;
		$('input').each(function() {
			$(this).val(change_flow_str(airport, new_config, $(this).val()));
		});
		if (new_config == 0) { // Left clicked
			$("#" + airport + "_standard_left").addClass("selected");
			$("#" + airport + "_standard_right").removeClass("selected");
			if (airport == "SFO") {
				$("#" + airport + "_standard_middle").removeClass("selected");
			}
		} else if (new_config == 1) { // Right clicked (middle for SFO)
			$("#" + airport + "_standard_left").removeClass("selected");
			if (airport == "SFO") {
				$("#" + airport + "_standard_right").removeClass("selected");
				$("#" + airport + "_standard_middle").addClass("selected");
			} else {
				$("#" + airport + "_standard_right").addClass("selected");
			}
		} else if (new_config == 2) { // right clicked (SFO)
			$("#" + airport + "_standard_left").removeClass("selected");
			$("#" + airport + "_standard_middle").removeClass("selected");
			$("#" + airport + "_standard_right").addClass("selected");
		}
	} else if (!override_duplicated) { console.log("Unknown new_config: " + new_config);
	} else { console.log("Click registered, but no change detected"); }
}

function compute (str_override = "") {
	var output = "Check the input box and make sure you pasted the right thing.";
	var reg;
	var narrow_ci_min = 10;
	var narrow_ci_max = 80;
	var wide_ci_min = 40;
	var wide_ci_max = 300;
	var exc_regex = /\n\!\n/g;
	var fkeystxt = ((str_override != 0 && str_override.trim().length > 0) ? str_override : $("#outbound").val());
	var routes_arr = {'faa_pref' : null, 'non_rnav' : null, 'cdrs' : {} };
	

	// TODO: remove exclamation points in multi-edit
	//console.log(fkeystxt);

	$("#ob_copy").val($("#outbound").val());
	$("#total").html("");
	rega = /TOW\n(\d+)\n(\d+)\n([^\n]*)\nLDW\n(\d+)\n(\d+)\n/g;
	regb = /light\n\n([A-Z]{4})\n+[^\n]+\n[^\n]+\n\n[^\n]+\n\n([A-Z]{4})[\s\S]+AA[LT]([\dA-Z]+)\n\!\nC I\:[^\(]+\([^\s]+\s([^\,\n\.]+)[\,\n\.][^\n]*\n[\s\S]+\)\n([A-Za-z0-9]{3})\nMEL/g;

	// ATCSCC CDRS
	// https://www.fly.faa.gov/rmt/cdm_operational_coded_departur.jsp
	regc = /\d\t([^\t]{8})\t([A-Z]{4})\t([A-Z]{4})\t[^\t]*\t([^\t]+)\t[^\t]*\t[^\t]*\t[^\t]*\t([YN])\t(\d)\t/g;

	// Decs route page
	regz = /[DI][\d]+\s+\d+\s[A-Z]\s[A-Z]\s[A-Z][^\n]+\n\s*ARTC TEXT/g;

	// Airway
	regy = /\<(\d+)\s\<(K\d)\s\<([^\s]+)\s/g;
/*
	// STAR - FOS: IDAFXXX (XXX is apt)
	regx = /([A-Z]+\d{1})\s+([A-Z]+)\s+([^\n\s]+)/g;
	if ((result = regx.exec(fkeystxt)) != null) {
		$("#total").html('<br/>' + fos_star_info(fkeystxt));
		return;
	}
*/
	var testing = false;
	var land_wgt_limited = false;
	// For Testing Station Info
	// XXXYYY | x = dptr | y = arr
	if (fkeystxt.replaceAll(" ","").length == 6) {
		fkeystxt = fkeystxt.replaceAll(" ","");
		testing = true;
	}

	tmp_rslt = regb.exec(fkeystxt);

	if ((result = regz.exec(fkeystxt)) != null) {
		// DECS routing page
/* TODO
		if ((regc.exec(fkeystxt)) != null) {
			// Check for ATSCC CDR page
			routes_arr['cdr_list'] = cdr_parse(fkeystxt, true);
		}
  */
		output = decs_route(fkeystxt, routes_arr['cdr_list']);
	} else if ((result = regc.exec(fkeystxt)) != null) {
		// TODO get array from compute first
		
		// ATSCC CDR page ONLY
		output = cdr_parse(fkeystxt);
	} else if (testing || ((result = rega.exec(fkeystxt)) != null)) {
		var mlwa = 7777;
		var mlwb = 7777;
		if (!testing) {
			mlwa = parseInt(result[2]) - parseInt(result[1]); // Takeoff weight buffer
			mlwb = parseInt(result[5]) - parseInt(result[4]); // Landing weight buffer
			land_wgt_limited = ((mlwa < mlwb) ? false : true);
			if (result[3] == "E") { // Using Method 1
				mlwa = mlwb;
			}
		}

		// Get ac_type
		var ac_type = (testing ? "321R" : get_ac_type(tmp_rslt[5]));

		output = "MTOW SPREAD: ";
		var reg_ci = /C\sI\:(\d+)[^\d]/g;
		if (mlwa < mlwb) {
			output += '<span style="color:';
			if (mlwa <= 2000) {
				output += 'red';
			} else if (mlwa <= 5000) {
				output += 'orange';
			} else {
				output += 'green';
			}
			output += '"><b>' + ((mlwa > 9999) ? "10K+" : mlwa) + "</b></span>";
			if (mlwa <= 5000) {
				output += "&nbsp;&nbsp;&nbsp;<b>Takeoff Wgt Rstr</b>";
				if ((ci_res = reg_ci.exec(fkeystxt)) != null) {
					var ci_int = parseInt(ci_res);
					
					
					console.log(ci_int);
					console.log(parseInt(ci_res));

					
					if (["319S", "H319", "319W", "A320", "H205", "738M", "738K", "738R", "321T", "A321", "321E", "321K", "321R", "321N"].includes(ac_type)) {
						// Narrow Body
						if (ci_int > 20) {
							output += "<br/><b style='color:yellow'>CI is " + ci_int + " - consider lowering to increase MTOW spread (min " + narrow_ci_min + ")</b>";
						}
					} else if (["B772", "773W", "7878", "7879", "789P"].includes(ac_type)) {
						// Wide Body
						if (ci_int > 50) {
							output += "<br/><b style='color:yellow'>CI is " + ci_int + " - consider lowering to increase MTOW spread (min " + wide_ci_min + ")</b>";
						}
					}
				}
			}
		} else {
			output += '<span style="color:';
			if (mlwb <= 2000) {
				output += 'red';
			} else if (mlwb <= 5000) {
				output += 'orange';
			} else {
				output += 'green';
			}
			output += '"><b>' + ((mlwb > 9999) ? "10K+" : mlwb) + "</b></span>";
			if (mlwb <= 5000) {
				 output += "&nbsp;&nbsp;&nbsp;<b>Land Wgt Rstr</b>";
				if ((ci_res = reg_ci.exec(fkeystxt)) != null) {
					var ci_int = parseInt(ci_res);
					
					console.log(ci_int);
					console.log(parseInt(ci_res));

					
					if (["319S", "H319", "319W", "A320", "H205", "738M", "738K", "738R", "321T", "A321", "321E", "321K", "321R", "321N"].includes(ac_type)) {
						// Narrow Body
						if (ci_int > 20) {
							output += "<br/><b style='color:yellow'>CI is " + ci_int + " - consider lowering to increase MTOW spread (min " + narrow_ci_min + ")</b>";
						}
					} else if (["B772", "773W", "7878", "7879", "789P"].includes(ac_type)) {
						// Wide Body
						if (ci_int > 50) {
							output += "<br/><b style='color:yellow'>CI is " + ci_int + " - consider lowering to increase MTOW spread (min " + wide_ci_min + ")</b>";
						}
					}
				}
			}
			if (!testing && result[3] == "E" && !land_wgt_limited) {
				output += "&nbsp;&nbsp;&nbsp;<b style='color:orange'>Method 1 in use</b>";
			}
		}
		if (["321T", "A321", "321K", "321R", "321N"].includes(ac_type)) { // 321E (Neos) are ok
			reg_fob = /TOTAL[^\d]*(\d+)[^\d]/g;
			var unnecessary_var = reg_fob.exec(fkeystxt);
			if (unnecessary_var && parseInt(unnecessary_var[1]) > 47000) {
				output += "<br/><b style='color:" + ((parseInt(unnecessary_var[1]) > 49000) ? "red" : "orange") + "'>A321 balance issues when FOB above 47000 lbs (Cur FOB " + parseInt(unnecessary_var[1]) + " - Coordinate with loads)</b>";
			}
		}
	} else {
		console.log("regb parse error");
	}
	if (testing || (tmp_rslt != null)) {
		/*
	 	*	1 - Dptr Station
	 	*	2 - Arvl Station
	   	*	3 - Flt Number
		* 	4 - Captain
	   	*	5 - Tail Number
		*/
		if (testing) {
			result = [null,
				fkeystxt.substring(0, 3).toUpperCase(),
				fkeystxt.substring(3, 6).toUpperCase(),
				7777,
				"TESTING",
				"850"
			];
		} else {
			result = tmp_rslt;
		}

		var tmpres = result[3] + '&nbsp;&nbsp;&nbsp;' + result[1] + '&nbsp;&nbsp;&nbsp;' + result[5] + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + result[4];
		output = tmpres + '<br/>' + output;

		// Approach Category
		output += "<br/>" + ac_type + "&nbsp;&nbsp;&nbsp;CAT ";
		if (["319S", "H319", "319W", "A320", "H205", "B772"].includes(ac_type)) {
			// Cat C
			output += "C"; // 121-141 Kts
		} else if (["738M", "738K", "738R", "321T", "A321", "321E", "321K", "321R", "321N", "773W", "7878", "7879", "789P"].includes(ac_type)) {
			// Cat D
			output += "D"; // 141-165 Kts
		} else { output += "Unknown"; }
		// Cost Index
		output += "&nbsp;&nbsp;||&nbsp;&nbsp;ci: ";
		if (["319S", "H319", "319W", "A320", "H205", "738M", "738K", "738R", "321T", "A321", "321E", "321K", "321R", "321N"].includes(ac_type)) {
			// Narrow Body
			output += narrow_ci_min + " - " + narrow_ci_max + " (lower/slower/lighter)";
		} else if (["B772", "773W", "7878", "7879", "789P"].includes(ac_type)) {
			// Wide Body
			output += wide_ci_min + " - " + wide_ci_max + " (lower/slower/lighter)";
		} else { output += "Unknown"; }

		// Non-scheduled flight
		if (result[3] > 8999 && result[3] < 10000) {
			// Reminder to amend flight type if non-scheduled
			output += "<br/><b style='color:orange'>Change flight type in ATC filing for all non-scheduled flights (Click envelope, flight type dropdown -> 'N')</b>";
			if (result[1] == "KDCA" || result[2] == "KDCA") {
				// Reminder to contact TSA for unscheduled DCA flights
				output += "<br/><b style='color:red'>DCA TSA must be contacted at least one hour prior to departure for non-scheduled operations (DPM 5.6.1)</b>";
			}
		}

		// Airport Specific
		output = airport_extra(result[1], result[2], result[5], ac_type, output);
	} else if (regz.exec(fkeystxt) == null && regy.exec(fkeystxt) == null && regc.exec(fkeystxt) == null) {
		console.log("flifo parse error");
	}

	// Tanker | Ferry Fuel
	regc = /(\d+)\t\d+\:\d+\tH\n+TOTAL/g;
	if ((tmpres = regc.exec(fkeystxt)) != null) {
		output += "<br/>Ferry Fuel: <b>" + tmpres[1] + "</b>";
	}

	// Routes
	if (regz.exec(fkeystxt) == null && regy.exec(fkeystxt) == null && regc.exec(fkeystxt) == null && result != null) {
		var tmp_test = get_routes(result[1], result[2], result[5], ac_type, output);
		output = tmp_test[0];
		$("#outbound").val(tmp_test[1]);
		document.title = tmp_test[1];
	}

	$("#total").html('<br/>' + output);
	if (regz.exec(fkeystxt) == null && regy.exec(fkeystxt) == null && result != null) {
		change_flow(((result[1].length == 4) ? (result[1].substr(1, 4)) : result[1]), flows[((result[1].length == 4) ? (result[1].substr(1, 4)) : result[1])], true);
		change_flow(((result[2].length == 4) ? (result[2].substr(1, 4)) : result[2]), flows[((result[2].length == 4) ? (result[2].substr(1, 4)) : result[2])], true);
	}
}

function cdr_parse(input = null, to_array = false, result_arr = {'faa_pref' : {}, 'non_rnav' : {}, 'cdrs' : {}}) {
	if (input == null) { return ""; }
	var today = new Date();
	var today_str = String(today.getMonth() + 1).padStart(2, '0') + "-" + String(today.getDate()).padStart(2, '0') + "-" + String(today.getFullYear());
	var today_str_short = String(today.getMonth() + 1) + "/" + String(today.getDate()) + "/" + String(today.getYear()-100);
	var reg_tmp = /\d\t[A-Z]{6}([^\t]{2})\t([A-Z]{4})\t([A-Z]{4})\t[^\t]*\t([^\t]+)\t[^\t]*\t[^\t]*\t[^\t]*\t([YN])\t(\d)\t([^\n]*)\n/g;
	var dptr = "KXXX";
	var arvl = "YYY";
	var faa_pref = "";
	var non_rnav = "";
	var non_rnav_coordreq = true;
	var cdr_str = "";
	var playbooks = {};
	while(null != (z = reg_tmp.exec(input))) {
		dptr = z[2].substring(0, 4);
		arvl = z[3].substring(1, 4);
		var textarea_tabs = ((["KCLT","KDFW","KLAX","KMIA","KORD","KPHX"].includes(dptr)) ? "\n\t\t\t" : "\n\t\t\t\t\t");
		var file_status = "<span style=\\\"color:" + ((z[5] == "Y") ? "red\\\"> (Coord Req)" : "green\\\"> (Ok to File)") + "<\/span>";

		// FAA Pref
		if (dptr == "KCLT" && z[1] == "RP") { // CLT
			faa_pref = "result += \"<br/><input style=\\\"width:75%\\\" value=\\\"" + z[4] + "\\\" readonly>\"; \/\/ CDR RP";
			result_arr['faa_pref'] = {'route' : z[4], 'notes' : 'CDR RP', 'avg_fl' : null, 'result_str' : "result += \"<br/><input style=\\\"width:75%\\\" value=\\\"" + z[4] + "\\\" readonly>\"; \/\/ CDR RP"};
		} else if (dptr == "KDCA" && z[1] == "00") { // DCA
			faa_pref = "result += \"<br/><input style=\\\"width:75%\\\" value=\\\"" + z[4] + "\\\" readonly>\"; \/\/ CDR 00";
			result_arr['faa_pref'] = {'route' : z[4], 'notes' : 'CDR 00', 'avg_fl' : null, 'result_str' : "result += \"<br/><input style=\\\"width:75%\\\" value=\\\"" + z[4] + "\\\" readonly>\"; \/\/ CDR 00"};
		} else if (dptr == "KDFW" && z[1] == "0P") { // DFW
			faa_pref = "result += \"<br/><input style=\\\"width:75%\\\" value=\\\"" + z[4] + "\\\" readonly>\"; \/\/ CDR 0P";
			result_arr['faa_pref'] = {'route' : z[4], 'notes' : 'CDR 0P', 'avg_fl' : null, 'result_str' : "result += \"<br/><input style=\\\"width:75%\\\" value=\\\"" + z[4] + "\\\" readonly>\"; \/\/ CDR 0P"};
		} else if (dptr == "KORD" && z[1] == "0E") { // ORD
			faa_pref = "result += \"<br/><input style=\\\"width:75%\\\" value=\\\"" + z[4] + "\\\" readonly>\"; \/\/ CDR 0E";
			result_arr['faa_pref'] = {'route' : z[4], 'notes' : 'CDR 0E', 'avg_fl' : null, 'result_str' : "result += \"<br/><input style=\\\"width:75%\\\" value=\\\"" + z[4] + "\\\" readonly>\"; \/\/ CDR 0E"};
		} else if (dptr == "KPHL" && z[1] == "PH") { // PHL
			faa_pref = "result += \"<br/><input style=\\\"width:75%\\\" value=\\\"" + z[4] + "\\\" readonly>\"; \/\/ CDR PH";
			result_arr['faa_pref'] = {'route' : z[4], 'notes' : 'CDR PH', 'avg_fl' : null, 'result_str' : "result += \"<br/><input style=\\\"width:75%\\\" value=\\\"" + z[4] + "\\\" readonly>\"; \/\/ CDR PH"};
		}

		// Playbook
		z[7] = z[7].trim();
		if (z[7].length > 0) {
			playbooks[z[7]] = {'route' : z[4], 'desc' : z[7], 'coord_req' : ((z[5] == "N") ? false : true),
						 'result_str' : ("result += \"<br/>" + z[7] + file_status + ": <input style=\\\"width:75%\\\" value=\\\"" + z[4] + "\\\" readonly>\";") };
		}

		// Non Rnav
		if (z[6] == 1 && (non_rnav.length == 0 || (non_rnav_coordreq && z[5] == "N"))) {
			non_rnav_coordreq = ((z[5] == "Y") ? true : false);
			non_rnav = "result += \"<br/><input style=\\\"width:75%\\\"; value=\\\"" + z[4] + "\\\"; readonly>\"; \/\/ CDR " + z[1];
			if (result_arr['non_rnav'] == null) {
				result_arr['non_rnav'] = {'route' : z[4], 'coord_req' : non_rnav_coordreq, 'notes' : ("CDR " + z[1]), 'result_str' : ("result += \"<br/><input style=\\\"width:75%\\\" value=\\\"" + z[4] + "\\\" readonly>\"; \/\/ CDR " + z[1]) };
			}
		}

		// CDRs
		cdr_str += textarea_tabs + "result += \"<br/>" + z[1] + file_status + ": <input class=\\\"cdr_input\\\" style=\\\"width:75%\\\" value=\\\"" + z[4] + "\\\" readonly>\";";
		result_arr['cdrs'][z[1]] = {'route' : z[4], 'notes' : ("CDR " + z[1]), 'verified' : today_str, 'result_str' : ("result += \"<br/>" + z[1] + file_status + ": <input class=\\\"cdr_input\\\" style=\\\"width:75%\\\" value=\\\"" + z[4] + "\\\" readonly>\";") };
	}

	// Sort Playbooks
	var sortable = [];
 	for (var key in playbooks) {
		// playbook, route, coord_req, result_str
		sortable.push([playbooks[key]['desc'], playbooks[key]['route'], playbooks[key]['coord_req'], playbooks[key]['result_str']]);
	}
	if (sortable.length > 1) {
		sortable.sort(function(x, y) {
			// playbook, route, coord_req, result_str
			//  0         1        2         3
			return (x[0].localeCompare(y[0]));
		});
	}
	if (sortable.length > 0) {
		sortable[0][3] = sortable[0][3].replace('result += \"<br/>', 'result += \"<br/><br/>');
	}
	result_arr['other'] = sortable;

	result_arr['arvl'] = ((arvl.length == 4) ? arvl.substring(1, 4) : arvl);
	result_arr['dptr'] = ((dptr.length == 4) ? dptr.substring(1, 4) : dptr);
	// merge_str_arr(get_routes(result_arr['dptr'], result_arr['arvl']), result_arr);

	var playbook_str = "";
	for (var i = 0; i < sortable.length; i++) {
		playbook_str += sortable[i][3] + textarea_tabs;
	}

	var new_cdr_str = "";
	reg_tmp_cdrstr = /result\s\+\=\s\"\<br\/\>([^\<]+)(\<span\sstyle[^\>]+\>\s\([^\)]+\)\<\/span\>)\:\s\<[^\>]+\s(value\=\\\"[^\"]+\")\sreadonly/g;
	while(null != (z = reg_tmp_cdrstr.exec(cdr_str))) {
		new_cdr_str += "<br/>CDR " + z[1] + z[2].replaceAll("\\", "") + ": <input class=\"cdr_input\" style=\"width:75%\" " + z[3].replaceAll("\\", "") + " readonly><br/>" +
			z[1] + ": <input style=\'width:75%\' value=\'" +
			"result += \"<br/>XXX" + ((z[2].includes("Coord Req")) ? "<span style=\\\"color:red\\\"> (Coord Req)</span>: " : "<span style=\\\"color:green\\\"> (Ok to File)</span>: ") + 
			"<input style=\\\"width:75%\\\" " + z[3] + " readonly>\"; \/\/ CDR " + z[1] + "\' readonly><br/>";
	}

	var faa_result = merge_faa_pref(result_arr, today_str);
	var output = '<b style=\'color:red\'>' + faa_result['errors'] + '<\/b>' +
		'<span style=\'color:orange\'>' + faa_result['warnings']  + '<\/span>' +
		'<br/><br/><textarea rows="8" cols="80">' + "case \"" + arvl +
		"\": document.title=\"MR U" + today_str_short + "\"; // Updated " + today_str +
		" // Mandatory Routes checked" + textarea_tabs +
		"result += \"<br/><br/><b>Faa Pref Route:</b>\";" + textarea_tabs + faa_pref + textarea_tabs +
		playbook_str + 
		((non_rnav.length == 0) ? "// " : "") + "result += \"<br/><br/><b>Non RNAV</b>\";" +
		((non_rnav.length == 0) ? " // TODO" : (textarea_tabs + non_rnav)) +
		'</textarea><br/><br/><textarea rows="15" cols="80">' +
		"result += \"<br/><br/><b>CDRS</b>\"; \/\/ Verified with ATCSCC on " + today_str +
		cdr_str + textarea_tabs + "break;</textarea><br/><br/>" + new_cdr_str +
		"<br/><br/><button onclick=\"clear_input(0)\">Clear</button>";
	if (to_array) { return result_arr; }
	return output;
}

function merge_faa_pref(result_arr = {}) {
	var textarea_tabs = ((["CLT","DFW","LAX","MIA","ORD","PHX","KCLT","KDFW","KLAX","KMIA","KORD","KPHX"].includes(dptr)) ? "\n\t\t\t" : "\n\t\t\t\t\t");
	var errors = "";
	var warnings = "";
	var status = "";
	if (today_str == null || today_str.trim().length == 0) {
		var today = new Date();
		var today_str = String(today.getMonth() + 1).padStart(2, '0') + "-" + String(today.getDate()).padStart(2, '0') + "-" + today.getFullYear();
	}
	var result = "";
	var dptr = result_arr['dptr'];
	var arvl = result_arr['arvl'];

	// FAA PREF
	var tmp_test_2 = get_routes(dptr, arvl);
	var existing_routes = tmp_test_2[0];
	reg_faapref = /\<b\>Faa Pref Route([^\:]*)\:\<\/b\>\<br\/\>\<input[^\>]+value\=\"([^\"]+)\"/g;
	var faa_pref = reg_faapref.exec(existing_routes);
	if (faa_pref != null) {
		faa_pref['avg_fl'] = ((faa_pref['avg_fl'] === undefined) ? "" : faa_pref['avg_fl']);
	}

	if (faa_pref == null || faa_pref[2].trim().length == 0) {
		// Faa Pref not detected in existing routes
		warnings += "<span style=\"color:orange\">No existing FAA Pref route detected.<\/b><br/>";
		if (result_arr['faa_pref']['route'] !== undefined) {
			// Pref route in CDR list, but not already existing
			result += "result += \"<br/><br/><b>Faa Pref Route:</b>\";" + textarea_tabs;
			result += "result += \"<br/><input style=\\\"width:75%\\\" value=\\\"" + result_arr['faa_pref']['route'] + "\\\" readonly>\"; \/\/ " + result_arr['faa_pref']['notes'];
		} else {
			// No pref routes in either CDR list or already existing
			result += "// result += \"<br/><br/><b>Faa Pref Route:</b>\"; // No FAA Pref route as of " + today_str + textarea_tabs + textarea_tabs;
		}
	} else {
		// Faa Pref exists in existing routes
		if (result_arr['faa_pref']['route'] !== undefined) {
			// Pref route in CDR list and already existing
			result += "result += \"<br/><br/><b>Faa Pref Route" + faa_pref['avg_fl'] + ":</b>\";" + textarea_tabs;
			if (result_arr['faa_pref']['route'].localeCompare(faa_pref[2])) {
				errors += "<b style=\"color:red\">Pref routes dont match- defaulted to existing route. Check CDR list vs. existing route<\/b><br\/>";
			} else { status += "Existing pref route matches CDR"; }
			result += "result += \"<br/><input style=\\\"width:75%\\\" value=\\\"" + result_arr['faa_pref']['route'] + "\\\" readonly>\";";
		} else {
			// Pref route already existing, but not CDR list
			result += "result += \"<br/><br/><b>Faa Pref Route" + faa_pref['avg_fl'] + ":</b>\";" + textarea_tabs;
			result += "result += \"<br/><input style=\\\"width:75%\\\" value=\\\"" + faa_pref[2] + "\\\" readonly>\";";
		}
	}

	// OTHER ROUTES

	// NON RNAV

	// CDRS

	console.log(faa_pref);
	console.log(result_arr);
	console.log(existing_routes);

	return {'result' : result, 'errors' : errors, 'warnings' : warnings, 'status' : status};
}

function decs_route(input = null, cdr_list = null) {
	var result = "";
	var result_arr = {};
	var textarea_tabs = "";
	var faa_pref = "";
	if (input == null) { return ""; }

	reg_tmp = /[DI](\d+)\s+(\d+)\s[^\s]\s[^\s]\s[^\s]([^\n]*)\n\sARTC\sTEXT\s*([^‡¥]+?)REMARKS([^\n]*)\n/g;
	while(null != (z = reg_tmp.exec(input))) {
		var tmp_rid = parseInt(z[1]);
		var distance = parseInt(z[2]);

		// Comments
		z[3] = z[3].replaceAll("¶", "").replaceAll("¥", "").trim();
		z[5] = z[5].replaceAll("¶", "").replaceAll("¥", "").trim();

		// Route
		const rte_regexa = /[\s¶\n]/g;
		z[4] = z[4].replace(rte_regexa, '');
		z[4] = z[4].replaceAll(".DCT.",".").replaceAll("."," ").trim();
		z[4] = z[4].replaceAll("-"," ");
		z[4] = z[4].split("¥MD20")[0];
		z[4] = z[4].split("‡MD20")[0];

		// SIDS / STARS out of date
		z[4] = z[4].replace("PRICY3 KMCO", "PRICY4 KMCO");
		z[4] = z[4].replace("PRICY3 MCO", "PRICY4 MCO");
		z[4] = z[4].replace("RKSTR3 KLAS", "RKSTR4 KLAS");
		z[4] = z[4].replace("RKSTR3 LAS", "RKSTR4 LAS");
		z[4] = z[4].replace("CHOWW2 KLAS", "CHOWW3 KLAS");
		z[4] = z[4].replace("CHOWW2 LAS", "CHOWW3 LAS");
		z[4] = z[4].replace("GLADZ3 KMIA", "GLADZ4 KMIA");
		z[4] = z[4].replace("GLADZ3 MIA", "GLADZ4 MIA");
		
		// Origin
		if (z[4].substring(3, 4) == " ") {
			// Origin 4th character is space, need country prefix: IAH => KIAH
			z[4] = convert_icao(z[4].substring(0,3)) + " " + z[4].substring(4);
		}
		// Destination
		if ((z[4].substring(z[4].length - 4, z[4].length - 3)) == " ") {
			// Destination 1th character is space, need country prefix: IAH => KIAH
			z[4] = z[4].substring(0, z[4].length - 3) + convert_icao(z[4].substring(z[4].length - 3));
		}

		// Add to route array
		var cdr_name = null;
		var tmp_notes = "";
		var cdr_textarea_output = "";
		if (z[5].length > 0) {
			tmp_notes = z[5];
			if (z[3].length > 0) { tmp_notes += " || " + z[3]; }
		} else {
			if (z[3].length > 0) { tmp_notes =  z[3]; }
		}

		var tmp_tmp_notes = tmp_notes;
		if (tmp_notes.includes("CDR ")) {
			// CDR
			var cdr_regex = /CDR\s[A-Z]{6}([A-Z0-9]{2})/g;
			if ((tmp_cdrkey = cdr_regex.exec(tmp_notes)) != null) {
				var file_status = "";
				if (tmp_notes.includes("NO FILE") || tmp_notes.includes("COORD RQRD")) {
					file_status = " (Coord Req)";
				} else if (tmp_notes.includes("OK TO FILE")) {
					file_status = " (Ok to File)";
				}

				var output_value = "result += \"<br/>" + tmp_cdrkey[1] + file_status + ": <input class=\\\"cdr_input\\\" style=\\\"width:75%\\\" value=\\\"" + z[4] + "\\\" readonly>\";";
				tmp_notes += "<br/>CDR " + tmp_cdrkey[1] + ": <input style=\'width:75%\' value=\'" + output_value + "\' readonly>";
				cdr_name = tmp_cdrkey[1];
				cdr_textarea_output = output_value;
				var tmp_dptr = z[4].substring(0,4);
				if (tmp_dptr == "KDFW" && cdr_name == "0P") { // DFW
					faa_pref = "result += \"<br/><input style=\\\"width:75%\\\" value=\\\"" + z[4] + "\\\" readonly>\"; \/\/ CDR 0P";
				} else if (tmp_dptr == "KORD" && cdr_name == "0E") { // ORD
					faa_pref = "result += \"<br/><input style=\\\"width:75%\\\" value=\\\"" + z[4] + "\\\" readonly>\"; \/\/ CDR 0E";
				} else if (tmp_dptr == "KCLT" && cdr_name == "RP") { // CLT
					faa_pref = "result += \"<br/><input style=\\\"width:75%\\\" value=\\\"" + z[4] + "\\\" readonly>\"; \/\/ CDR RP";
				} else if (tmp_dptr == "KPHL" && cdr_name == "PH") { // PHL
					faa_pref = "result += \"<br/><input style=\\\"width:75%\\\" value=\\\"" + z[4] + "\\\" readonly>\"; \/\/ CDR PH";
				}
			}
		} else if (tmp_notes.includes("PLAYBOOK ")) {
			// PLAYBOOK
			var output_value = "result += \"<br/><input style=\\\"width:75%\\\"; value=\\\"" + z[4] + "\\\" readonly>\";";
			tmp_notes += "<br/><input style=\'width:75%\'; value=\'" + output_value + "\' readonly>";
			
			var playbook_regex = /PLAYBOOK ([^\|]+)/g;
			while(null != (pkey = playbook_regex.exec(tmp_tmp_notes))) {
				var output_value = "result += \"<br/>" + pkey[1] + ": <input style=\\\"width:75%\\\"; value=\\\"" + z[4] + "\\\" readonly>\";";
				tmp_notes += "<br/>PLAYBOOK " + pkey[1] + ": <input style=\'width:75%\'; value=\'" + output_value + "\' readonly>";
			}
		} else {
			// OTHER
			var output_value = "result += \"<br/><input style=\\\"width:75%\\\"; value=\\\"" + z[4] + "\\\" readonly>\";";
			tmp_notes += "<br/><input style=\'width:75%\'; value=\'" + output_value + "\' readonly>";
		}

		

		result_arr[parseInt(z[1])] = {'route':z[4], 'notes':tmp_notes, 'distance':parseInt(z[2]), 'cdr':cdr_name, 'cdr_textarea_output': cdr_textarea_output };
		textarea_tabs = ((["KCLT","KDFW","KLAX","KMIA","KORD","KPHX"].includes(z[4].substring(0, 4))) ? "\n\t\t\t" : "\n\t\t\t\t\t");

	} // End of Loop

	// Convert to Array to sort
	var sortable = [];
 	for (var key in result_arr) {
		// CDR, distance, notes, route_string
		sortable.push([result_arr[key]['cdr'], result_arr[key]['distance'], result_arr[key]['notes'], result_arr[key]['route'], result_arr[key]['cdr_textarea_output']]);
	}
	
	sortable.sort(function(x, y) {
		// CDR, distance, notes, route_string
		//  0       1        2         3
		if (x[0] != null || y[0] != null) {
			// At least one CDR
			if (x[0] != null && y[0] != null) {
				// Both CDRs
				return (x[0].localeCompare(y[0])); 
			} else {
				// One CDR, One Not
				if (x[0] == null) { return -1; }
				return 1;
			}
		} else {
			// Both not CDRS, sort by distance	
			if (x[1] < y[1]) {
				// x is higher on list
				return -1;
			}
			if (x[1] > y[1]) {
				// x is lower on list
				return 1;
			}
			return 0;
		}
	});

	var textarea_cdr_arr = [];
	var today = new Date();
	var tmp_arvl_arr = sortable[0][3].split(" ");
	var tmp_res_mid = "";
	for (let i = 0; i < sortable.length; ++i) {
		tmp_res_mid += "<br/>" + sortable[i][3] + "<br/>" + sortable[i][2] + "<br/><hr>";
		if (sortable[i][0] != null) {
			textarea_cdr_arr.push(sortable[i][4]);
		}
	}
	result += '<br/><textarea rows="5">case "' + convert_iata(tmp_arvl_arr[tmp_arvl_arr.length - 1]) + '": // Updated ' +
		 String(today.getMonth() + 1).padStart(2, '0') + "-" + String(today.getDate()).padStart(2, '0') + "-" +
		 today.getFullYear() + textarea_tabs + 'result += "<br/><br/><b>Faa Pref Route:</b>";' + textarea_tabs +
			faa_pref + textarea_tabs +
			'result += "<br/><br/><b>Non RNAV</b>";' + textarea_tabs +
			'' + textarea_tabs +
			((textarea_cdr_arr.length == 0) ? '' : ('result += "<br/><br/><b>CDRS</b>";' + textarea_tabs)) +
			((textarea_cdr_arr.length == 0) ? '// result += "<br/><br/><b>CDRS</b>";' : textarea_cdr_arr.join(textarea_tabs)) + textarea_tabs +
			'break;'
		+ "</textarea>";
	result += tmp_res_mid;
	result += '<textarea rows="15" cols="80">' + textarea_cdr_arr.join(textarea_tabs) + '</textarea>';
	return result;
}

function airport_extra (dptr = "XXX", arvl = "XXX", tail = null, ac_type = null, result = "") {
	dptr = ((dptr.length == 4) ? (dptr.substr(1, 4)) : dptr);
	arvl = ((arvl.length == 4) ? (arvl.substr(1, 4)) : arvl);

	switch(dptr) {
		case "ABQ":
			result += "<br/><br/>ABQ Flow: <button type='button' id='ABQ_standard_left' class='btn" + ((flows['ABQ'] == 0) ? " selected" : "") + "' onclick='change_flow(\"ABQ\", 0)'>East</button>&nbsp;&nbsp;<button type='button' id='ABQ_standard_right' class='btn" + ((flows['ABQ'] == 1) ? " selected" : "") + "' onclick='change_flow(\"ABQ\", 1)'>West</button>";
			result += "<br/>ABQ - DOOKK WEST FLOW // MNZNO EAST FLOW";
			break;
		case "BFL":
			result += "<br/><br/>BFL - 12R/30L N/A, see 10-7A";
			break;
		case "BOI":
			result += "<br/><br/>Run VAA above 30C";
			break;
		case "BTV":
			result += "<br/><br/>BTV - Rwy15 limited due to terrain/ Tower will accommodate rwy33 with tailwind";
			break;
		case "BUR":
			result += "<br/><br/>BUR - ATC prefers 15, even with a tailwind";
			break;
		case "BZN":
			result += "<br/><br/>BZN - Run VAA above 25C; Rwy30 is about 3k lbs better";
			result += "<br/><br/>BZN Flow: <button type='button' id='BZN_standard_left' class='btn" + ((flows['BZN'] == 0) ? " selected" : "") + "' onclick='change_flow(\"BZN\", 0)'>SE Rwy 12</button>&nbsp;&nbsp;<button type='button' id='BZN_standard_right' class='btn" + ((flows['BZN'] == 1) ? " selected" : "") + "' onclick='change_flow(\"BZN\", 1)'>NW Rwy 30</button>";
			break;
		case "COS":
			result += "<br/><br/>COS - LAWS above 10C";
			result += "<br/>COS - Rwy31 N/A, see 10-7A-1";
			break;
		case "DCA":
			result += "<br/><br/>Curfew rstr 2200L - 0659L";
			var tmp_mtow = get_dca_mtow(ac_type, tail);
			if (tmp_mtow != null) { result += "<br/>" + tmp_mtow; }
			break;
		case "DEN":
			result += "<br/><br/>Run VAA when hot";
			break;
		case "EGE":
			result += "<br/><br/>EGE Rwy 25 is preferred, even with tailwind";
			result += "<br/>EGE VAA 25X for icing conditions 1000 - 10,000 Feet";
			result += "<br/>EGE ARFF manages snow plow ops and notams";
			break;
		case "EYW":
			result += "<br/><br/>Wet/Dry definitions FOM 2.1.6";
			result += "<br/>EYW - Check VAA if wet or departing rwy 9";
			result += "<br/>EYW - Tailwind N/A (1kt is about 10k lbs penalty)";
			result += "<br/>EYW - Max crosswind 20 knots, see 10-7A-1";
			break;
		case "FAT":
			result += "<br/><br/>FAT - Run VAA if departing rwy29L (not common)";
			break;
		case "GJT":
			result += "<br/><br/>GJT - Run VAA above 25C";
			break;
		case "IAH":
			result += "<br/><br/>IAH Flow: <button type='button' id='IAH_standard_left' class='btn" + ((flows['IAH'] == 0) ? " selected" : "") + "' onclick='change_flow(\"IAH\", 0)'>West</button>&nbsp;&nbsp;<button type='button' id='IAH_standard_right' class='btn" + ((flows['IAH'] == 1) ? " selected" : "") + "' onclick='change_flow(\"IAH\", 1)'>East</button>";
			break;
		case "JAC":
			result += "<br/>JAC - Always check VAA, rwy19 is better";
			result += "<br/>JAC - Tailwind or Contaminated rwy takeoff N/A";
			result += "<br/><br/>JAC Flow: <button type='button' id='JAC_standard_left' class='btn" + ((flows['JAC'] == 0) ? " selected" : "") + "' onclick='change_flow(\"JAC\", 0)'>South</button>&nbsp;&nbsp;<button type='button' id='JAC_standard_right' class='btn" + ((flows['JAC'] == 1) ? " selected" : "") + "' onclick='change_flow(\"JAC\", 1)'>North</button>";
			result += "<br/>JAC - ALPIN/TETON S FLOW (rwy19) // DIVYD/GEYSER N FLOW (rwy1)";
			break;
		case "LAX":
			if (ac_type.includes("321")) {
				result += "<br/><br/>A321 - File OSHNN instead of ORKAS";
			} else {
				result += "<br/><br/>LAX curfew 2100L - 0700L // File OSHNN instead of ORKAS";
			}
			break;
		case "LGA":
			if (ac_type == "738M") {
				result += "<br/><br/>B737 MAX acft are not subject to pier weights";
			}
			break;
		case "MIA":
			result += "<br/><br/>MIA - GLADZ EAST FLOW // BNGOS WEST FLOW";
			break;
		case "MRY":
			result += "<br/><br/>MRY - Run VAA if using rwy10R";
			break;
		case "MSO":
			result += "<br/><br/>MSO Flow: <button type='button' id='MSO_standard_left' class='btn" + ((flows['MSO'] == 0) ? " selected" : "") + "' onclick='change_flow(\"MSO\", 0)'>SE Rwy 12</button>&nbsp;&nbsp;<button type='button' id='MSO_standard_right' class='btn" + ((flows['MSO'] == 1) ? " selected" : "") + "' onclick='change_flow(\"MSO\", 1)'>NW Rwy 30</button>";
			break;
		case "MTJ":
			result += "<br/><br/>MTJ - Rwy 13/31 N/A";
			break;
		case "PHX":
			result += "<br/><br/>PHX - Make sure flow matches TPS; Usually departing into the sun (East in AMs, West in PMs)";
			break;
		case "PSP":
			result += "<br/><br/>PSP - Run VAA for rwy31L";
			break;
		case "RDM":
			result += "<br/><br/>RDM - Rwy11/29 N/A for A320 and non-sharklet A321, see 10-7A-2";
			break;
		case "RNO":
			result += "<br/><br/>Use 10-7 Pages and SIDS for takeoff mins";
			result += "<br/>Max climb gradient 525 feet per NM; Some Rwy17L/17R departures exceed 525 ft/nm (see 10-7C)";
			result += "<br/><br/>RNO Flow: <button type='button' id='RNO_standard_left' class='btn" + ((flows['RNO'] == 0) ? " selected" : "") + "' onclick='change_flow(\"RNO\", 0)'>South</button>&nbsp;&nbsp;<button type='button' id='RNO_standard_right' class='btn" + ((flows['RNO'] == 1) ? " selected" : "") + "' onclick='change_flow(\"RNO\", 1)'>North</button>";
			result += "<br/><br/>RNO - ALPYN NORTH FLOW // ZEFFR SOUTH FLOW";
			break;
		case "SAN":
			result += "<br/><br/>SAN - East Flow (Rwy9): Takeoff Mins 600-2// BORDER SID lower mins";
			result += "<br/>SAN - Curfew rstr: Takeoff prohibited 2330 - 0630L";
			// result += "<br/><br/>SAN Landing: <button type='button' id='SAN_standard_left' class='btn" + ((flows['SAN'] == 0) ? " selected" : "") + "' onclick='change_flow(\"SAN\", 0)'>West Rwy27</button>&nbsp;&nbsp;<button type='button' id='SAN_standard_right' class='btn" + ((flows['SAN'] == 1) ? " selected" : "") + "' onclick='change_flow(\"SAN\", 1)'>East Rwy9</button>";
			break;
		case "SBA":
			result += "<br/><br/>SBA - Run VAA; Rwy 25 is about 2000lbs worse.";
			result += "<br/>SBA - Tailwind takeoff N/A.";
			result += "<br/>SBA - Check NOTAMs for crane penalty";
			break;
		case "SBP":
			result += "<br/><br/>SBP - Mountains off rwy11; Watch winds and run VAA";
			break;
		case "SFO":
			result += "<br/>";
			if (["P798", "N787", "E787","B772","W773"].includes(ac_type)) {
				result += "<br/>Rwy19L N/A and rwy19R N/A for B787 and B777 (See comply memo)";
			}
			result += "<br/>SFO curfew (2100-0700L): Dptrs to northeast use NIITE";
			result += "<br/><br/>SFO Dptg: <button type='button' id='SFO_standard_left' class='btn" + ((flows['SFO'] == 0) ? " selected" : "") + "' onclick='change_flow(\"SFO\", 0)'>1L/1R</button>&nbsp;&nbsp;<button type='button' id='SFO_standard_middle' class='btn" + ((flows['SFO'] == 1) ? " selected" : "") + "' onclick='change_flow(\"SFO\", 1)'>28L/28R</button>&nbsp;&nbsp;<button type='button' id='SFO_standard_right' class='btn" + ((flows['SFO'] == 2) ? " selected" : "") + "' onclick='change_flow(\"SFO\", 2)'>10LR/19LR</button>";
			break;
		case "SJC":
			result += "<br/><br/>SJC Flow: <button type='button' id='SJC_standard_left' class='btn" + ((flows['SJC'] == 0) ? " selected" : "") + "' onclick='change_flow(\"SJC\", 0)'>North</button>&nbsp;&nbsp;<button type='button' id='SJC_standard_right' class='btn" + ((flows['SJC'] == 1) ? " selected" : "") + "' onclick='change_flow(\"SJC\", 1)'>South</button>";
			result += "<br/><br/>SJC Rwy 12L/R - ALMDN BMRNG TECKYM<br/>Rwy 30L/30R - LOUPE SJC3 SPTNS";
			result += "<br/><br/>SJC - Curfew rstr: 2330-0630L (see 10-9A), 30 min extension possible";
			result += "<br/>SJC - B737 MAX and A32F NEO exempt from curfew (see 10-7A-2)";
			break;
		case "SLC":
			result += "<br/>SLC - Run VAA in summer";
			result += "<br/><br/>SLC Flow: <button type='button' id='SLC_standard_left' class='btn" + ((flows['SLC'] == 0) ? " selected" : "") + "' onclick='change_flow(\"SLC\", 0)'>North</button>&nbsp;&nbsp;<button type='button' id='SLC_standard_right' class='btn" + ((flows['SLC'] == 1) ? " selected" : "") + "' onclick='change_flow(\"SLC\", 1)'>South</button>";
			result += "<br/><br/>SLC - ARCHZ|SEVYR NORTH FLOW // ZIONZ SOUTH FLOW // RUGGD DEZRT BOTH";
			break;
		case "SMF":
			result += "<br/><br/>SMF - Run VAA above 25C";
			result += "<br/><br/>SMF Flow: <button type='button' id='SMF_standard_left' class='btn" + ((flows['SMF'] == 0) ? " selected" : "") + "' onclick='change_flow(\"SMF\", 0)'>North</button>&nbsp;&nbsp;<button type='button' id='SMF_standard_right' class='btn" + ((flows['SMF'] == 1) ? " selected" : "") + "' onclick='change_flow(\"SMF\", 1)'>South</button>";
			result += "<br/>SMF - RVRCT NORTH FLOW // SCTWN SOUTH FLOW";
			break;
		case "SNA":
			result += "<br/>";
			if (arvl == "PHX") {
				// Comply memo 3/26/24 Class E SNA Noise Abatement Restrictions
				result += "<br/><b>SNA - Class E flights rstr MTOW 167.500 on 321E acft</b>";
			}
			result += "<br/>SNA - Check VAA, especially when wet";
			result += "<br/>SNA - Curfew rstr: takeoff N/A without approval 2155-0700L (0800L on Sundays), 15 min extension possible";
			result += "<br/><br/>SNA Flow: <button type='button' id='SNA_standard_left' class='btn" + ((flows['SNA'] == 0) ? " selected" : "") + "' onclick='change_flow(\"SNA\", 0)'>South</button>&nbsp;&nbsp;<button type='button' id='SNA_standard_right' class='btn" + ((flows['SNA'] == 1) ? " selected" : "") + "' onclick='change_flow(\"SNA\", 1)'>North</button>";
			break;
		case "TUS":
			result += "<br/><br/>TUS - BURRO Rwy12 // WLDKT Rwy30 // TUS9 all";
			result += "<br/><br/>TUS Flow: <button type='button' id='TUS_standard_left' class='btn" + ((flows['TUS'] == 0) ? " selected" : "") + "' onclick='change_flow(\"TUS\", 0)'>SE Rwy 12</button>&nbsp;&nbsp;<button type='button' id='TUS_standard_right' class='btn" + ((flows['TUS'] == 1) ? " selected" : "") + "' onclick='change_flow(\"TUS\", 1)'>NW Rwy 30</button>";
			break;
		case "VPS":
			result += "<br/><br/>VPS - If arresting cables are inop, use B runways for TPS";
			break;
		case "YYC":
			result += "<br/><br/>YYC required weekend dptr: GADKI-VOBUK-GGW";
			break;
	}

	switch(arvl) {
		case "ABQ":
			result += "<br/>ABQ - Send RAIM check. No ILS Rwy21 or Rwy26";
			result += "<br/>ABQ - Rwy12/30 N/A (See 10-7A)";
			break;
		case "ATL":
			result += "<br/><br/>ATL Flow: <button type='button' id='ATL_standard_left' class='btn" + ((flows['ATL'] == 0) ? " selected" : "") + "' onclick='change_flow(\"ATL\", 0)'>West</button>&nbsp;&nbsp;<button type='button' id='ATL_standard_right' class='btn" + ((flows['ATL'] == 1) ? " selected" : "") + "' onclick='change_flow(\"ATL\", 1)'>East</button>";
			result += "<br/>ATL - SITTH EAST FLOW // JJEDI WEST FLOW";
			break;
		case "BFL":
			result += "<br/><br/>BFL - 12R/30L N/A, see 10-7A";
			break;
		case "BHM":
			result += "<br/><br/>BHM - Landing 18/36 N/A per 10-7";
			break;
		case "BIL":
			result += "<br/><br/>BIL - Run VAA if departing rwy28R";
			break;
		case "BUR":
			result += "<br/><br/>BUR - Voluntary curfew 2200-0700L";
			result += "<br/>BUR - Wet: Use LAWS, ATC prefers rwy33 and rwy8";
			break;
		case "BZN":
			result += "<br/><br/>BZN - Run LAWS above 30C";
			result += "<br/>BZN Night: Circle to Land N/A";
			result += "<br/><br/>BZN Flow: <button type='button' id='BZN_standard_left' class='btn" + ((flows['BZN'] == 0) ? " selected" : "") + "' onclick='change_flow(\"BZN\", 0)'>SE Rwy 12</button>&nbsp;&nbsp;<button type='button' id='BZN_standard_right' class='btn" + ((flows['BZN'] == 1) ? " selected" : "") + "' onclick='change_flow(\"BZN\", 1)'>NW Rwy 30</button>";
			break;
		case "COS":
			result += "<br/><br/>COS - Rwy31 N/A";
			break;
		case "DCA":
			result += "<br/><br/>Curfew rstr 2200L - 0659L";
			var tmp_mlw = get_dca_mlw(ac_type, tail);
			if (tmp_mlw != null) { result += "<br/>" + tmp_mlw; }
			break;
		case "DEN":
			result += "<br/><br/>DEN - Run LAWS above 20C";
			break;
		case "DFW":
			result += "<br/><br/>DFW Flow: <button type='button' id='DFW_standard_left' class='btn" + ((flows['DFW'] == 0) ? " selected" : "") + "' onclick='change_flow(\"DFW\", 0)'>South</button>&nbsp;&nbsp;<button type='button' id='DFW_standard_right' class='btn" + ((flows['DFW'] == 1) ? " selected" : "") + "' onclick='change_flow(\"DFW\", 1)'>North</button>";
			result += "<br/>DFW SOUTH FLOW - VKTRY / SEEVR / BOOVE / BEREE<br/>DFW NORTH FLOW - JOVEM / BRDJE / SOCKK / WHINY";
			break;
		case "DTW":
			result += "<br/><br/>DTW Flow: <button type='button' id='DTW_standard_left' class='btn" + ((flows['DTW'] == 0) ? " selected" : "") + "' onclick='change_flow(\"DTW\", 0)'>North</button>&nbsp;&nbsp;<button type='button' id='DTW_standard_right' class='btn" + ((flows['DTW'] == 1) ? " selected" : "") + "' onclick='change_flow(\"DTW\", 1)'>South</button>";
			result += "<br/>DTW SOUTH FLOW - BONZZ / HTROD / TPGUN / FERRL / LAYKS / HANBL / VCTRZ / RKCTY";
			result += "<br/>DTW NORTH FLOW - KLYNK / CRAKN / CUUGR / WNGNT / GRAYT / LECTR / HAYLL / KKISS";
			break;
		case "EGE":
			result += "<br/><br/>EGE Can handle 3 acft max: 2 gates + deice pad. Expect station to call for delay.";
			result += "<br/>EGE ARFF manages snow plow ops and notams";
			result += "<br/><br/>EGE: Send RAIM Check RNP .11 // LAWS above 37C";
			result += "<br/>EGE Night: MALSR and PAPI required for night arrivals.";
			result += "<br/>EGE RWY 7 and Visual 25 N/A after Civil Twilght";
			break;
		case "EYW":
			result += "<br/><br/>Wet/Dry definitions FOM 2.1.6";
			result += "<br/>EYW - Max crosswind 20 knots (see 10-7B)";
			result += "<br/><br/>EYW Night: Papi and GPS required (see 10-7B)";
			break;
		case "GEG":
			result += "<br/><br/>GEG - Run LAWS above 35C";
			break;
		case "GUC":
			result += "<br/><br/>GUC Night: VOR, Circle-to-Land, Visual N/A; RWY 24 N/A";
			result += "<br/>GUC Cold Temp chart below -26C";
			break;
		case "IAH":
			result += "<br/><br/>IAH Flow: <button type='button' id='IAH_standard_left' class='btn" + ((flows['IAH'] == 0) ? " selected" : "") + "' onclick='change_flow(\"IAH\", 0)'>West</button>&nbsp;&nbsp;<button type='button' id='IAH_standard_right' class='btn" + ((flows['IAH'] == 1) ? " selected" : "") + "' onclick='change_flow(\"IAH\", 1)'>East</button>";
			result += "<br/>IAH - DRLLR WEST FLOW // GUSHR EAST FLOW";
			break;
		case "JAC":
			result += "<br/><br/>JAC - 5k spread on ferry fuel";
			result += "<br/>JAC Winter: Coordinate for rwy clearing per F-2";
			result += "<br/>JAC Cold Temp chart below -21C";
			result += "<br/>JAC Night: Visual approaches N/A, ARFF curfew 2330L";
			break;
		case "LAS":
			result += "<br/><br/>LAS - Run LAWS above 35C";
			break;
		case "MCO":
			result += "<br/><br/>MCO Flow: <button type='button' id='MCO_standard_left' class='btn" + ((flows['MCO'] == 0) ? " selected" : "") + "' onclick='change_flow(\"MCO\", 0)'>South</button>&nbsp;&nbsp;<button type='button' id='MCO_standard_right' class='btn" + ((flows['MCO'] == 1) ? " selected" : "") + "' onclick='change_flow(\"MCO\", 1)'>North</button>";
			result += "<br/>MCO - SNFLD NORTH FLOW // GTOUT SOUTH FLOW // GRNCH PRICY ALYNA BOTH";
			break;
		case "LAS":
			result += "<br/><br/>MFE - Notify Ops of any arrivals after midnight local";
			break;
		case "MSO":
			result += "<br/><br/>MSO - Cold Temp Correction only available ILS Rwy12 below -12C (FOM 9w.4)";
			result += "<br/>MSO - Run LAWS above 35C";
			break;
		case "MTJ":
			result += "<br/><br/>MTJ No Control Tower at all";
			result += "<br/>MTJ RWY 13/31 N/A";
			result += "<br/>MTJ Night: Rwy 35 N/A, no circle to land";
			break;
		case "PSP":
			result += "<br/><br/>PSP - send RAIM check, no ILS procedures";
			break;
		case "RDM":
			result += "<br/><br/>RDM - Rwy11/29 N/A for A320 and non-sharklet A321, see 10-7A-2";
			result += "<br/>RDM - TSA closes 1945L";
			break;
		case "RIC":
			result += "<br/><br/>RIC - primary AA gates A6 and A8, AE gates A10 A12 A14";
			break;
		case "RNO":
			result += "<br/><br/>RNO Flow: <button type='button' id='RNO_standard_left' class='btn" + ((flows['RNO'] == 0) ? " selected" : "") + "' onclick='change_flow(\"RNO\", 0)'>South</button>&nbsp;&nbsp;<button type='button' id='RNO_standard_right' class='btn" + ((flows['RNO'] == 1) ? " selected" : "") + "' onclick='change_flow(\"RNO\", 1)'>North</button>";
			break;
		case "SAN":
			result += "<br/><br/>SAN Landing: <button type='button' id='SAN_standard_left' class='btn" + ((flows['SAN'] == 0) ? " selected" : "") + "' onclick='change_flow(\"SAN\", 0)'>West Rwy27</button>&nbsp;&nbsp;<button type='button' id='SAN_standard_right' class='btn" + ((flows['SAN'] == 1) ? " selected" : "") + "' onclick='change_flow(\"SAN\", 1)'>East Rwy9</button>";
			// result += "<br/>SAN - TOPGN EAST FLOW // LUCKI WEST FLOW";
			break;
		case "SBA":
			result += "<br/><br/>SBA - Ferry fuel spread 5k";
			break;
		case "SBP":
			result += "<br/><br/>SBP - Run LAWS when wet; LDA 5300 feet";
			break;
		case "SJC":
			if (["321E", "738M"].includes(ac_type)) { // A32F neo & B737 max
				result += "<br/><br/>SJC - " + ((ac_type == "738M") ? "B737 MAX" : "A32F NEO") + " acft are exempt from curfew (see 10-7A-2)";
			} else {
				result += "<br/><br/>SJC - Curfew rstr: 2330-0630L (see 10-9A), 30 min extension possible";
			}
			break;
		case "SLC":
			result += "<br/><br/>SLC - Run LAWS above 30C";
			result += "<br/><br/>SLC Flow: <button type='button' id='SLC_standard_left' class='btn" + ((flows['SLC'] == 0) ? " selected" : "") + "' onclick='change_flow(\"SLC\", 0)'>North</button>&nbsp;&nbsp;<button type='button' id='SLC_standard_right' class='btn" + ((flows['SLC'] == 1) ? " selected" : "") + "' onclick='change_flow(\"SLC\", 1)'>South</button>";
			break;
		case "SNA":
			result += "<br/><br/>SNA - DSNEE SOUTH FLOW // ROOBY NORTH FLOW";
			result += "<br/><br/>SNA - Curfew rstr: landing N/A without approval 2300-0705L (0805L on Sundays), 15 min extension possible";
			break;
		case "TUS":
			result += "<br/><br/>TUS - Run LAWS above 35C";
			result += "<br/>TUS - RAIM check if landing northwest/rwy30";
			result += "<br/>TUS - Night: Visual appr N/A (see 10-7B)";
			break;
		case "YEG":
			result += "<br/><br/>ATL - SITTH EAST FLOW // JJEDI WEST FLOW";
			break;
		case "YUL":
			result += "<br/><br/>YUL - Curfew rstr 0100L - 0700L, Extensions authorized";
			break;
		case "YVR":
			result += "<br/><br/>YVR - Curfew rstr 0000L - 0600L, Extensions authorized";
			result += "<br/>YVR - Rwy 13/31 N/A";
			break;
		case "YYC":
			result += "<br/><br/>YYC - If alt needed: Check Customs for YEG; GEG is a good backup";
			break;
		case "YYZ":
			result += "<br/><br/>YYZ - Curfew 0030-0630L; Extensions authorized (else pay fine)";
			result += "<br/>Airbus and Boeing are Stage3 acft";
			break;
	}
	result = add_sara_rmks(arvl, result);
	return result;
}

Array.prototype.unique = function() {
    return this.filter(function (value, index, self) {
      return self.indexOf(value) === index;
    });
}
	
/*
function get_wind_limits(ac_type = null, tail = null) {
	if (ac_type == null) { return null; }
	var wind_limits = ["takeoff" => ["headwind" => 50], "landing" => ["headwind" => 50]];

	if (ac_type == "319S") {}
	if (["319W","H319"].includes(ac_type)) {
		if (parseInt(tail.charAt(0)) == 8) {
			// H319 with IAE engines
		} else {
			//H319 with CFM engines and 319W
		}
	}
	if (ac_type == "A320") {
		
	}
	if (ac_type == "H205") {
		
	}
	if (["321R", "321T", "321K"].includes(ac_type)) {
		if (parseInt(tail.charAt(0)) == 1) {
			// 321K with CFM engines
			
		} else {
			// 321R, 321T, and 321K with IAE engines
		}
	}
	if (ac_type == "321E") {
		
	}
	if (["738K", "738R", "738M"].includes(ac_type)) {
		// B737 NG and MAX
		wind_limits["xwind"] = [
			"takeoff" => ["tailwind" => 15],
			"landing" => ["tailwind" => 10],
			"hudto" => ["tailwind" => 10]
		];
		if (ac_type == "738M") {
			// B737 MAX Only

		}
	}
	return null;
}
*/
function get_dca_mtow(ac_type = null, tail = null) {
	if (ac_type == null) { return null; }
	if (ac_type == "319S") { return "MTOW 162.600 to comply with DCA curfew noise limits"; }
	if (["319W","H319"].includes(ac_type)) {
		// H319 with IAE engines
		if (parseInt(tail.charAt(0)) == 8) { return "MTOW 153.000 to comply with DCA curfew noise limits"; }
		//H319 with CFM engines and 319W
		return "MTOW 159.700 to comply with DCA curfew noise limits";
	}
	if (ac_type == "A320") { return "MTOW 165.500 to comply with DCA curfew noise limits"; }
	if (ac_type == "H205") { return "MTOW 158.900 to comply with DCA curfew noise limits"; }
	if (["321R", "321T", "321K"].includes(ac_type)) {
		// 321K with CFM engines
		if (parseInt(tail.charAt(0)) == 1) { return "MTOW 153.000 to comply with DCA curfew noise limits"; }
		// 321R, 321T, and 321K with IAE engines
		return "MTOW 184.400 to comply with DCA curfew noise limits";
	}
	if (ac_type == "321E") { return "No DCA curfew MTOW penalties for A321 NX"; }
	if (["738K", "738R"].includes(ac_type)) { return "MTOW 166.800 to comply with DCA curfew noise limits"; }
	if (ac_type == "738M") { return "No DCA curfew MTOW penalties for B737 MAX"; }
	return null;
}

function get_dca_mlw(ac_type = null, tail = null) {
	if (ac_type == null) { return null; }
	if (["319S", "319W", "H319"].includes(ac_type)) { return "No DCA curfew MLW penalties for A319"; }
	if (["A320", "H205"].includes(ac_type)) { return "No DCA curfew MLW penalties for A320"; }
	if (["321R", "321T", "321K"].includes(ac_type)) {
		// 321K with CFM engines
		if (parseInt(tail.charAt(0)) == 1) { return "MLW 131.700 to comply with DCA curfew noise limits"; }
		// 321R, 321T, and 321K with IAE engines
		return "MLW 166.400 to comply with DCA curfew noise limits";
	}
	if (ac_type == "321E") { return "No DCA curfew MLW penalties for A321 NX"; }
	if (["738K", "738R"].includes(ac_type)) { return "MLW 140.200 to comply with DCA curfew noise limits"; }
	if (ac_type == "738M") { return "No DCA curfew MLW penalties for B737 MAX"; }
	return null;
}

function get_ac_type(tail = "") {
	if (tail.length != 3) { return null; }
	var first = parseInt(tail.charAt(0));
	if (isNaN(first)) { return null; }
	switch (first) {
		case 0:
			if (S319.includes(tail)) { return "319S"; };
			break;
		case 1:
			if (A320.includes(tail)) { return "A320"; };
			if (A321.includes(tail)) { return "A321"; };
			if (K321.includes(tail)) { return "321K"; };
			break;
		case 2:
			if (A332.includes(tail)) { return "A332"; };
			break;
		case 3:
			if (M738.includes(tail)) { return "738M"; };
			if (K738.includes(tail)) { return "738K"; };
			if (R738.includes(tail)) { return "738R"; };
			if (["3PV", "3PW", "3PX"].includes(tail)) { return "738R"; }
			break;
		case 4:
			if (E321.includes(tail)) { return "321E"; };
			break;
		case 5:
			if (A321.includes(tail)) { return "A321"; };
			if (K321.includes(tail)) { return "321K"; };
			break;
		case 6:
			if (H205.includes(tail)) { return "H205"; };
			break;
		case 7:
			if (isNaN(parseInt(tail.charAt(1)))) {
				// Letter after initial 7 i.e. "7LH"
				if (B772.includes(tail)) { return "B772"; };
				if (W773.includes(tail)) { return "773W"; };
			} else {
				// Three numbers i.e. "777"
				if (T321.includes(tail)) { return "321T"; };
				if (H319.includes(tail)) { return "H319"; };
				if (W319.includes(tail)) { return "319W"; };
				if (R321.includes(tail)) { return "321R"; };
			}
			break;
		case 8:
			if (isNaN(parseInt(tail.charAt(1)))) {
				// Letter after initial 8 i.e. "8AL"
				if (E787.includes(tail)) { return "7878"; };
				if (N787.includes(tail)) { return "7879"; };
				if (P789.includes(tail)) { return "789P"; };
			} else {
				// Three numbers i.e. "876"
				if (H319.includes(tail)) { return "H319"; };
				if (R321.includes(tail)) { return "321R"; };
			}
			break;
		case 9:
			if (K321.includes(tail)) { return "321K"; };
			if (R321.includes(tail)) { return "321R"; };
			if (N321.includes(tail)) { return "321N"; };
			break;
	}
	return null;
}

function add_sara_rmks(arvl = null, result = "") {
	if (["AVL", "IFP", "BUR", "BTV", "DRO", "EGE", "GDL", "GUC", "HDN", "JAC", "EYW", "BJX", "MEX", "MSO", "MRY", "ONT", "PSP", "OAX", "RDM", "RNO", "SAN", "SFO", "SBP", "DCA"].includes(arvl)) {
		// result += "<br/><br/>SARA airport";
	}
	if (["GUC", "JAC", "EYW", "MEX", "OAX", "RDM", "SBP"].includes(arvl)) {
		result += ": CA needs 75 hrs in AC type// FAM page review required";
	} else if (arvl == "EGE") { result += ": Capt must have flown into EGE in the last 18 months"; }
	return result;
}

function get_month_name(id = -1) {
	if (id < 0 || id > 11) { return "NULL"; }
	return ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"][id];
}

function today(report_date = true) {
	var today = new Date();
	if (report_date && today.getHours() > 15) {
		today.setDate(today.getDate() + 1);
	}
	return (((today.getDate() < 10) ? ("0" + today.getDate()) : today.getDate()) + "-" +
		get_month_name(today.getMonth()) + "-" + today.getFullYear());
}

function clear_input (type = -1) {
	if (type == 0) {
		$("#outbound").val("");
	}
	$("#total").html("");
}

</script>
