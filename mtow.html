<head>
	<title>FKeys Helper</title>
	<meta name="viewport" content="user-scalable=no, width=device-width">
	<meta charset="UTF-8">

	<link href="css/bootstrap.min.css" rel="stylesheet" >
	<link href="css/style.css" rel="stylesheet" type="text/css">

	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
</head>

<body>
	FKeys Page: <textarea id="outbound" rows="5"></textarea>&nbsp;&nbsp;
	<button onclick="compute(0)">Go</button>&nbsp;&nbsp;<button onclick="clear_input(0)">Clear</button><br/>
<!--
	Inbound DSN: <textarea id="dsn" rows="5"></textarea>
	<button onclick="compute(3)">Go</button>&nbsp;&nbsp;<button onclick="clear_input(3)">Clear</button><br/>
	Inbound List: <textarea id="inbound" rows="5"></textarea>&nbsp;&nbsp;
	<button onclick="compute(1)">Go</button>&nbsp;&nbsp;<button onclick="clear_input(1)">Clear</button><br/>
	Rollover List: <textarea id="rollover" rows="5"></textarea>&nbsp;&nbsp;
	<button onclick="compute(2)">Go</button>&nbsp;&nbsp;<button onclick="clear_input(2)">Clear</button><br/>
	Ans: <textarea id="ans_txt" rows="5" style="width:300px"></textarea>
-->
	<div id="total"></div>
</body>

<script>
var gates = {};
var gate_changes = {};
var inbounds = {};

function compute (type = -1) {
	var output = "";
	var reg;
	$("#total").html("");
	rega = /TOW\n(\d+)\n(\d+)\n[\s\S]*LDW\n(\d+)\n(\d+)\n/g;
	regb = /Flight\n\n([A-Z]{4})\n+[^\n]+\n[^\n]+\n\n[^\n]+\n\n([A-Z]{4})[\s\S]+AAL(\d+)\n\!\nC I\:[^\(]+\([^\s]+\s([^\,]+)\,[\s\S]+\)\n([A-Za-z0-9]{3})\nMEL/g;
	
	var fkeystxt = $("#outbound").val();
	if ((result = rega.exec(fkeystxt)) != null) {
		var mlwa = parseInt(result[2]) - parseInt(result[1]);
		var mlwb = parseInt(result[4]) - parseInt(result[3]);

		output = "MTOW SPREAD: ";
		if (mlwa < mlwb) {
			output += '<span style="color:';
			if (mlwa <= 2000) {
				output += 'red';
			} else if (mlwa <= 5000) {
				output += 'orange';
			} else {
				output += 'green';
			}
			output += '"><b>' + ((mlwb > 9999) ? "10K+" : mlwa) + "</b></span>";
			if (mlwa <= 5000) {
				 output += "&nbsp;&nbsp;&nbsp;<b>Takeoff Wgt Rstr</b>";
			}
		} else {
			output += '<span style="color:';
			if (mlwb <= 2000) {
				output += 'red';
			} else if (mlwb <= 5000) {
				output += 'orange';
			} else {
				output += 'green';
			}
			output += '"><b>' + ((mlwb > 9999) ? "10K+" : mlwb) + "</b></span>";
			if (mlwb <= 5000) {
				 output += "&nbsp;&nbsp;&nbsp;<b>Land Wgt Rstr</b>";
			}
		}
	} else {
		console.log("regb parse error");
	}
	if ((result = regb.exec(fkeystxt)) != null) {
		/*
	 	*	1 - Dptr Station
	 	*	2 - Arvl Station
	   	*	3 - Flt Number
		* 	4 - Captain
	   	*	5 - Tail Number
		*/
		var tmpres = result[3] + '&nbsp;&nbsp;&nbsp;' + result[1] + '&nbsp;&nbsp;&nbsp;' + result[5] + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + result[4];
		output = tmpres + '<br/>' + output;
	} else {
		console.log("flifo parse error");
	}
	output = airport_extra(result[1], result[2], output);
	$("#total").html('<br/>' + output);
	$("#outbound").val("");
}

function airport_extra (dptr = "XXX", arvl = "XXX", result = "") {
	dptr = ((dptr.length == 4) ? (dptr.substr(1, 4)) : dptr);
	arvl = ((arvl.length == 4) ? (arvl.substr(1, 4)) : arvl);

	switch(dptr) {
		case "AUS":
			break;
		case "DFW":
			break;
		case "MIA":
			result += "<br/><br/>MIA - GLADZ EAST FLOW // BNGOS WEST FLOW";
			break;
		case "RNO":
			result += "<br/><br/>RNO - ALPYN NORTH FLOW // ZEFFR SOUTH FLOW";
			break;
	}

	switch(arvl) {
		case "DFW":
			result += "<br/><br/>DFW SOUTH FLOW - VKTRY / SEEVR / BOOVE / BEREE<br/>DFW NORTH FLOW - JOVEM / BRDJE / SOCKK / WHINY";
			break;
		case "IAH":
			result += "<br/><br/>IAH - DRLLR WEST FLOW // GUSHR EAST FLOW";
			break;
	}
	
	return result;
}
	
Array.prototype.unique = function() {
    return this.filter(function (value, index, self) {
      return self.indexOf(value) === index;
    });
}

function get_month_name(id = -1) {
	if (id < 0 || id > 11) { return "NULL"; }
	return ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"][id];
}

function today(report_date = true) {
	var today = new Date();
	if (report_date && today.getHours() > 15) {
		today.setDate(today.getDate() + 1);
	}
	return (((today.getDate() < 10) ? ("0" + today.getDate()) : today.getDate()) + "-" +
		get_month_name(today.getMonth()) + "-" + today.getFullYear());
}

function clear_input (type = -1) {
	if (type == 0) {
		$("#outbound").val("");
	}
	$("total").html("");
}
</script>
