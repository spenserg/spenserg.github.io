<head>
		<title>Spider Wiki Helper</title>
		<meta name="viewport" content="user-scalable=no, width=device-width">
		<meta charset="UTF-8">

		<link href="css/bootstrap.min.css" rel="stylesheet" >
		<link href="css/style.css" rel="stylesheet" type="text/css">

		<script src="js/jquery.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
</head>

<body>
	Citation: <input name="src" id="src" />
	<button onclick="compute()">Go</button><br/>
	Wiki Ref:<br/>
	<textarea id="wiki_ref"></textarea><br/><br/>
	
	Copy Paste Gen Page: <input name="gen_src" id="gen_src" />
	<button onclick="compute2()">Go</button><br/>
	Wiki page:
	<textarea id="wiki_page"></textarea><br/><br/>
</body>

<script>
	var authors = [
		["Dahl", "F", "Friedrich Dahl"],
		["Keyserling","E","Eugen von Keyserling"],
		["Koch","CL","Carl Ludwig Koch"],
		["Koch","L","Ludwig Carl Christian Koch"],
		["Kulczyński","W","Władysław Kulczyński"],
		["Lehtinen","PT","Pekka T. Lehtinen"],
		["Pickard-Cambridge","FO","Frederick Octavius Pickard-Cambridge"],
		["Pickard-Cambridge","O","Octavius Pickard-Cambridge"],
		["Platnick","N","Norman I. Platnick"],
		["Prószyński","J","Jerzy Prószyński"],
		["Roewer","C","Carl Friedrich Roewer"],
		["Simon","E","Eugène Simon"],
		["Thorell","T","Tamerlan Thorell"],
	];
	var families = [
		["Antrodiaetidae", "folding trapdoor spiders"],
		["Atracidae","Australian funnel web spiders"],
		["Atypidae","purseweb spiders"],
		["Barychelidae","brushed trapdoor spiders"],
		["Ctenizidae","trapdoor spiders"],
		["Cyrtaucheniidae","wafer trapdoor spiders"],
		["Dipluridae","curtain web spiders"],
		["Idiopidae","armored trapdoor spiders"],
		["Mecicobothriidae","dwarf tarantulas"],
		["Migidae","tree trapdoor spiders"],
		["Paratropididae","baldlegged spiders"],
		["Theraphosidae","tarantulas"],
		["Amaurobiidae","tangled nest spiders"],
		["Anyphaenidae","anyphaenid sac spiders"],
		["Araneidae","orb-weaver spiders"],
		["Archaeidae","assassin spiders"],
		["Clubionidae","sac spiders"],
		["Corinnidae","corinnid sac spiders"],
		["Ctenidae","wandering spiders"],
		["Deinopidae","net-casting spiders"],
		["Desidae","intertidal spiders"],
		["Diguetidae","coneweb spiders"],
		["Drymusidae","false violin spiders"],
		["Dysderidae","woodlouse hunter spiders"],
		["Eresidae","velvet spiders"],
		["Filistatidae","crevice weavers"],
		["Gnaphosidae","flat-bellied ground spiders"],
		["Gradungulidae","large-clawed spiders"],
		["Hahniidae","dwarf sheet spiders"],
		["Hersiliidae","tree trunk spiders"],
		["Hypochilidae","lampshade spiders"],
		["Liocranidae","liocranid sac spiders"],
		["Linyphiidae","dwarf spiders"],
		["Lycosidae","wolf spiders"],
		["Malkaridae","shield spiders"],
		["Mimetidae","pirate spiders"],
		["Miturgidae","long-legged sac spiders"],
		["Mysmenidae","spurred orb-weavers"],
		["Nesticidae","cave cobweb spiders"],
		["Ochyroceratidae","midget ground weavers"],
		["Oecobiidae","disc web spiders"],
		["Oonopidae","goblin spiders"],
		["Oxyopidae","lynx spiders"],
		["Palpimanidae","palp-footed spiders"],
		["Philodromidae","running crab spiders"],
		["Pholcidae","cellar spiders"],
		["Pisauridae","nursery web spiders"],
		["Plectreuridae","plectreurid spiders"],
		["Prodidomidae","long-spinneret ground spiders"],
		["Salticidae","jumping spiders"],
		["Scytodidae","spitting spiders"],
		["Segestriidae","tube dwelling spiders"],
		["Selenopidae","wall spiders"],
		["Sicariidae","recluse spider"],
		["Sparassidae","huntsman spiders"],
		["Stiphidiidae","sheetweb spiders"],
		["Symphytognathidae","dwarf orb-weavers"],
		["Telemidae","long-legged cave spiders"],
		["Tetragnathidae","long-jawed orb-weavers"],
		["Theridiidae","tangle-web spiders"],
		["Theridiosomatidae","ray spiders"],
		["Thomisidae","crab spiders"],
		["Uloboridae","cribellate orb-weavers"],
		["Zodariidae","ant spiders"]
	];
	
  function compute() {
    $("#wiki_src").val(get_citation($("#src").val()));
  }
	
	function compute2() {
		$("#wiki_page").val(get_page_data($("#gen_src").val()));
	}
 
function ref (ref = "") {
  var result = {};
  var cite_patt = /[\s]*(\S[\s\S]*)\(([0-9]+)[a-zA-Z]*\)[\.\s]*([\s\S]+) ([0-9()a-zA-Z]+)\:([\s\S]+)download pdf/;
  var info = cite_patt.exec(ref);
  var ref_name = "";

  if (info[1].includes("&")) {
    var allnames = info[1].replace("&",",").split(",");
    for (var i = 0; i < allnames.length; i += 2) {
      result['last' + (i/2 + 1)] = allnames[i].trim();
      result['first' + (i/2 + 1)] = allnames[i + 1].trim();
    }
    ref_name = result['last1'].substr(0,4) + info[2];
  } else {
    var tmp_name = info[1].split(',');
    result['last'] = tmp_name[0].trim();
    result['first'] = tmp_name[1].trim();
    ref_name = result['last'].substr(0,4) + info[2];
  }
  result['year'] = info[2];

  var pages_patt = /([0-9]+)[\s]*([\-]*)[\s]*([0-9]*)/;
  var tmp_ans = pages_patt.exec(info[5].replace("download pdf", ""));
  tmp_ans.shift();
  result['pages'] = tmp_ans.join('');

  tmp_ans = info[3].split(".");
  result['title'] = "";
  for (var i = 0; i < tmp_ans.length; i++) {
    if (i == tmp_ans.length - 1) {
      result['journal'] = tmp_ans[i].trim();
    } else {
      result['title'] += ((result['title'].length > 0) ? ". " : "") + tmp_ans[i].trim();
    }
  }
  if (info[4].includes("(")) {
    var iss_patt = /([^()]*)\(([^()]*)\)/;
    tmp_ans = iss_patt.exec(info[4]);
    result['volume'] = tmp_ans[1];
    result['issue'] = tmp_ans[2];
  } else {
    result['volume'] = info[4].trim();
  }

  var wiki_cite = "<ref name=" + ref_name + ">{{cite journal";
  for (var p in result) {
    wiki_cite += "| " + p + "=" + result[p];
  }
  return wiki_cite + "}}</ref>";
}
	
function get_page_data() {
	var str = $("#gen_src").val();
	var result = "{{Short description||Genus of spiders}}";
	var list = {};
  	var gen_patt = /Gen.\s([^\s]+)\s([\s\S]*,\s[0-9]{4}[)\s]*)\[/;
  	var tmp = gen_patt.exec(str);
  	list['genus'] = tmp[1].trim();
  	list['genus_auth'] = tmp[2].trim();

  	var fam_patt = /Family:\s([\S]+)\s/;
  	tmp = fam_patt.exec(str);
  	list['family'] = tmp[1].trim();
	
	result += "\n{{Automatic taxobox\n| taxon = " + list['genus'] +
    "\n| authority = " + list["genus_auth"] + "<ref name=NMBE />" +
    "\n| type species = ''[[" + list['type_species'] + "]]''" +
    "\n| subdivision_ranks = Species" +
    "\n| subdivision = " + list['num_spec'] + ", see text\n}}\n" +
    "'''''" + list['genus'] + "''''' is a [[genus]] of ";
	
	$("#wiki_page").val(result);
}
	
</script>
