<head>
		<title>SHelper</title>
		<meta name="viewport" content="user-scalable=no, width=device-width">
		<meta charset="UTF-8">

		<link href="css/bootstrap.min.css" rel="stylesheet" >
		<link href="css/style.css" rel="stylesheet" type="text/css">

		<script src="js/jquery.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
</head>

<body>
	Text: <textarea id="page_txt" rows="10"></textarea>
	<button onclick="compute()">Go</button><br/>
	<input type="checkbox" id="last_only" name="last_only" value="1">
	<label for="last_only"> Last Name Only</label><br/><br/>
  	Ans: <textarea id="ans_txt"></textarea>
</body>

<script>
  Array.prototype.unique = function() {
    return this.filter(function (value, index, self) { 
      return self.indexOf(value) === index;
    });
  }

  function compute() {
    var result = '';
    var ans = $("#page_txt").val();
    var ans_list = [];
    var r1 = new RegExp(/NEXT\sQUIZ\nPLAY\sANOTHER\n([\s\S]+)Today\'s\sDaily\sDose\n/, 'i');
    var r1b = new RegExp(/NEXT\sQUIZ\nPLAY\sANOTHER\n([\s\S]+)Remove Ads\./, 'i');
    var r2 = new RegExp(/\n[^\t]+\t([^\t\n]+)[\t\n]/, 'g');

    var split_1 = false;
    if (r1.test(ans)) {
	    split_1 = true;
	    ans = r1.exec(ans)[1];
    } else if (r1b.test(ans)) {
	    split_1 = true;
	    ans = r1b.exec(ans)[1];
    }
    
    if (split_1) {
	var list_ans = [];
	result = 'on run {input, parameters}\ntell application "Google Chrome" to activate\ntell Application "System Events"\ndelay 0.5';
	while ((array1 = r2.exec(ans)) !== null) {
		var tmp_ans = array1[1].normalize("NFD").replace(/[\u0300-\u036f]/g, "");
		if (document.getElementById("last_only").checked) {
			tmp_ans = tmp_ans.split(" ").pop();
		}
		if (!tmp_ans.includes("|")) {
			var rx = new RegExp(/(time[\d]+follow)/, 'i');
			if (!rx.test(tmp_ans)) {
				list_ans.push(tmp_ans.toLowerCase().trim());
			}
		}
	}
	list_ans = list_ans.unique();
	for (var i = 0; i < list_ans.length; i++) {
		result += '\nkeystroke "' + list_ans[i] + '"\nkeystroke "a" using {command down}\ndelay 0.5\nkey code 51';
	}  
	result += "\nend\nend run";
    }
    $('#ans_txt').val(result);
  }
</script>
